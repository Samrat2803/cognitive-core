# Artifact Storage Guide

## 📍 Where Artifacts Are Stored

**Location:** 
```
/Political_Analyst_Workbench/backend_server/artifacts/
```

**Full Path:**
```
/Users/samrat.sah/Desktop/code/prototypes/tavily_agent/exp_2/Political_Analyst_Workbench/backend_server/artifacts/
```

---

## 📊 Current Artifacts

```bash
$ ls -lh backend_server/artifacts/

line_14e23b9fd73d.html    4.4M    # Latest India GDP chart (HTML)
line_14e23b9fd73d.png      55K    # Latest India GDP chart (PNG)
line_3f4d259da8d2.html    4.4M    # Earlier test
line_3f4d259da8d2.png      55K    # Earlier test
line_445b1a8377eb.html    4.4M    # Earlier test
line_445b1a8377eb.png      55K    # Earlier test
```

---

## 🔗 How to Access Artifacts

### 1. Via API Endpoints

**HTML (Interactive):**
```
GET http://localhost:8000/api/artifacts/line_14e23b9fd73d.html
```

**PNG (Static Image):**
```
GET http://localhost:8000/api/artifacts/line_14e23b9fd73d.png
```

**Example:**
```bash
# Download artifact
curl http://localhost:8000/api/artifacts/line_14e23b9fd73d.png -o chart.png

# Open in browser
open http://localhost:8000/api/artifacts/line_14e23b9fd73d.html
```

### 2. Via File System

```bash
# Navigate to artifacts directory
cd Political_Analyst_Workbench/backend_server/artifacts/

# Open HTML in browser
open line_14e23b9fd73d.html

# View PNG
open line_14e23b9fd73d.png
```

### 3. Via Response JSON

When you call `/api/analyze`, the response includes artifact metadata:

```json
{
  "artifact": {
    "artifact_id": "line_14e23b9fd73d",
    "type": "line_chart",
    "html_path": "artifacts/line_14e23b9fd73d.html",
    "png_path": "artifacts/line_14e23b9fd73d.png",
    "data": {
      "x": ["2020", "2021", "2022", "2023", "2025"],
      "y": [-5.78, 9.69, 6.99, 8.15, 7.8],
      "x_label": "Year",
      "y_label": "GDP Growth Rate (%)"
    }
  }
}
```

Then fetch the artifact:
```javascript
const artifactUrl = `http://localhost:8000/api/artifacts/${data.artifact.artifact_id}.html`;
```

---

## 🏗️ Why This Location?

The artifacts are stored in `backend_server/artifacts/` because:

1. **Working Directory:** When the backend server runs, its working directory is `backend_server/`
2. **Relative Paths:** The visualization tools create files in `artifacts/` relative to the current working directory
3. **Simplicity:** Keeps artifacts close to the backend server code
4. **API Access:** Easy to serve via FastAPI's `FileResponse`

---

## 🔧 Architecture

```
Political_Analyst_Workbench/
├── langgraph_master_agent/        # Agent code
│   ├── nodes/                     # LangGraph nodes
│   └── tools/
│       └── visualization_tools.py # Creates artifacts
│
├── backend_server/                # FastAPI server
│   ├── app.py                     # Serves artifacts via /api/artifacts/*
│   └── artifacts/                 # ← ARTIFACTS STORED HERE
│       ├── line_*.html            # Interactive Plotly charts
│       └── line_*.png             # Static images
│
└── artifacts/                     # (empty - not used)
```

---

## 📝 Artifact Naming Convention

Format: `{type}_{id}.{extension}`

**Examples:**
- `line_14e23b9fd73d.html` - Line chart (HTML)
- `line_14e23b9fd73d.png` - Line chart (PNG)
- `bar_abc123def456.html` - Bar chart (HTML)
- `mindmap_xyz789.png` - Mind map (PNG)

**ID Generation:**
- 12-character hex string
- Generated by `uuid.uuid4().hex[:12]`
- Unique per artifact

---

## 🗄️ Storage Configuration

### Current Setup (File System)

```python
# In visualization_tools.py
artifact_id = f"line_{uuid.uuid4().hex[:12]}"
os.makedirs("artifacts", exist_ok=True)

html_path = f"artifacts/{artifact_id}.html"
png_path = f"artifacts/{artifact_id}.png"
```

### Optional: MongoDB Storage

If MongoDB is configured, artifacts are also saved to the database:

```python
artifact_data = {
    "type": "line_chart",
    "artifact_id": artifact_id,
    "html_path": html_path,
    "png_path": png_path,
    "data": {...},
    "created_at": datetime.utcnow().isoformat()
}

# Save to MongoDB (if configured)
await artifacts_collection.insert_one(artifact_data)
```

---

## 🧹 Cleanup & Management

### Manual Cleanup

```bash
# Delete old artifacts (older than 7 days)
find backend_server/artifacts/ -name "*.html" -mtime +7 -delete
find backend_server/artifacts/ -name "*.png" -mtime +7 -delete
```

### Automated Cleanup (Recommended)

Add to your deployment:

```bash
# Cron job (runs daily at 2 AM)
0 2 * * * find /path/to/backend_server/artifacts/ -mtime +7 -delete
```

Or use a background task in FastAPI:

```python
from fastapi_utils.tasks import repeat_every

@app.on_event("startup")
@repeat_every(seconds=86400)  # Once per day
async def cleanup_old_artifacts():
    """Delete artifacts older than 7 days"""
    cutoff_time = time.time() - (7 * 86400)
    for filename in os.listdir("artifacts/"):
        filepath = f"artifacts/{filename}"
        if os.path.getmtime(filepath) < cutoff_time:
            os.remove(filepath)
```

---

## 📊 Storage Considerations

### Disk Space

**Per Artifact:**
- HTML: ~4-5 MB (includes Plotly library)
- PNG: ~50-200 KB (static image)
- Total: ~5 MB per visualization

**Estimates:**
- 100 artifacts ≈ 500 MB
- 1,000 artifacts ≈ 5 GB
- 10,000 artifacts ≈ 50 GB

### Recommendations

**For Production:**
1. **Implement cleanup** - Delete artifacts > 7 days old
2. **Use cloud storage** - AWS S3, Google Cloud Storage
3. **Add pagination** - List artifacts API endpoint
4. **Monitor disk usage** - Alert when > 80% full

**For Development:**
- Current setup is fine
- Manually delete old artifacts as needed

---

## 🚀 Frontend Integration Example

### React Component

```jsx
function ArtifactViewer({ artifactId, type }) {
  const htmlUrl = `http://localhost:8000/api/artifacts/${artifactId}.html`;
  const pngUrl = `http://localhost:8000/api/artifacts/${artifactId}.png`;
  
  return (
    <div className="artifact">
      <h3>Generated Visualization</h3>
      
      {/* Interactive HTML version */}
      <iframe 
        src={htmlUrl} 
        width="100%" 
        height="600px"
        title="Artifact Visualization"
      />
      
      {/* Download buttons */}
      <div>
        <a href={htmlUrl} download>Download HTML</a>
        <a href={pngUrl} download>Download PNG</a>
      </div>
    </div>
  );
}
```

### Vue Component

```vue
<template>
  <div class="artifact">
    <h3>Generated Visualization</h3>
    <iframe 
      :src="`http://localhost:8000/api/artifacts/${artifactId}.html`"
      width="100%"
      height="600px"
    />
  </div>
</template>

<script>
export default {
  props: ['artifactId']
}
</script>
```

---

## ✅ Verification

**Test that artifacts are working:**

```bash
# 1. Check files exist
ls -lh backend_server/artifacts/

# 2. Test API endpoint
curl http://localhost:8000/api/artifacts/line_14e23b9fd73d.png -o test.png

# 3. Verify PNG
file test.png  # Should show: PNG image data

# 4. Open HTML in browser
open http://localhost:8000/api/artifacts/line_14e23b9fd73d.html
```

**Expected Results:**
- ✅ Files exist in `backend_server/artifacts/`
- ✅ API returns 200 OK
- ✅ PNG is valid image
- ✅ HTML opens interactive chart in browser

---

## 📞 Troubleshooting

### Artifacts Not Found (404)

**Problem:** API returns 404 for artifact requests

**Solution:**
1. Check if file exists: `ls backend_server/artifacts/`
2. Verify artifact ID matches
3. Ensure server working directory is `backend_server/`

### Artifacts in Wrong Location

**Problem:** Files created in `/Political_Analyst_Workbench/artifacts/` instead

**Solution:**
- Server must be started from `backend_server/` directory
- Or update paths in `visualization_tools.py` to use absolute paths

### Disk Space Full

**Problem:** Too many artifacts consuming disk space

**Solution:**
1. Implement cleanup script (see above)
2. Move old artifacts to cold storage
3. Use cloud storage for production

---

## 🎯 Summary

**Artifacts Location:**
```
Political_Analyst_Workbench/backend_server/artifacts/
```

**Access Methods:**
1. API: `http://localhost:8000/api/artifacts/{id}.(html|png)`
2. File System: Direct file access
3. Response JSON: Metadata includes paths

**File Types:**
- HTML: Interactive Plotly charts (~4-5 MB each)
- PNG: Static images (~50-200 KB each)

**Management:**
- Cleanup recommended for production
- Cloud storage for scale
- Monitor disk usage

The backend is now correctly configured to serve artifacts! 🎉

